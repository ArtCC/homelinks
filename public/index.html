<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Homelinks</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="stylesheet" href="/styles.css" />
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body style="visibility: hidden;">
  <script>
    // Check session before showing content to prevent flash
    (async function () {
      try {
        const response = await fetch("/api/session");
        if (response.ok) {
          const data = await response.json();
          if (data.authenticated) {
            document.body.style.visibility = "visible";
            return;
          }
        }
        window.location.href = "/login.html";
      } catch (err) {
        window.location.href = "/login.html";
      }
    })();
  </script>

  <main class="container">
    <header class="header">
      <div class="header-content">
        <h1>
          <i data-lucide="link-2" class="icon-logo"></i>
          Homelinks
        </h1>
        <p>Quick access to your Docker apps</p>
      </div>
      <div class="header-actions">
        <button id="view-toggle-btn" class="btn-ghost" title="Toggle view">
          <i data-lucide="grid-3x3" id="view-icon"></i>
        </button>
        <button id="theme-toggle-btn" class="btn-ghost" title="Toggle theme">
          <i data-lucide="monitor" id="theme-icon"></i>
        </button>
        <button id="logout-btn" class="btn-ghost">
          <i data-lucide="log-out"></i>
          <span>Logout</span>
        </button>
      </div>
    </header>

    <button id="add-app-btn" class="btn-primary btn-add-app">
      <i data-lucide="plus"></i>
      <span>Add app</span>
    </button>

    <section id="form-section" class="form-card" hidden>
      <h2 id="form-title">New app</h2>
      <form id="app-form">
        <input type="hidden" id="app-id" />
        <label>
          Name
          <input type="text" id="name" placeholder="Portainer" required />
        </label>
        <label>
          URL
          <input type="text" id="url" placeholder="http://server:9000" required />
        </label>
        <label>
          Image (optional, max 1024x1024, 1MB)
          <input type="file" id="image" accept="image/png,image/jpeg,image/webp" />
          <div id="image-preview" class="image-preview" hidden>
            <img id="preview-img" alt="Preview" />
            <button type="button" id="remove-preview" class="btn-icon" title="Remove image">
              <i data-lucide="x"></i>
            </button>
          </div>
        </label>
        <div id="form-error" class="form-error" hidden></div>
        <div class="form-actions">
          <button type="submit" id="save-btn">Save</button>
          <button type="button" id="cancel-btn" class="btn-ghost">
            Cancel
          </button>
        </div>
      </form>
    </section>

    <section class="list-card">
      <h2>Apps</h2>
      <div class="list-toolbar">
        <i data-lucide="search" class="search-icon"></i>
        <input type="search" id="search" placeholder="Search apps..." autocomplete="off" />
        <span id="count" class="count"></span>
      </div>
      <div id="empty" class="empty" hidden>
        <i data-lucide="inbox" class="empty-icon" id="empty-icon"></i>
        <p id="empty-message">You do not have any apps yet.</p>
        <p class="empty-hint" id="empty-hint">Click <strong>Add app</strong> to get started!</p>
      </div>
      <ul id="apps" class="apps"></ul>
      <div id="pagination" class="pagination" hidden>
        <button type="button" id="prev-page" class="btn-ghost">
          <i data-lucide="chevron-left"></i>
          <span>Prev</span>
        </button>
        <span id="page-info" class="page-info"></span>
        <button type="button" id="next-page" class="btn-ghost">
          <span>Next</span>
          <i data-lucide="chevron-right"></i>
        </button>
      </div>
    </section>
  </main>

  <template id="app-item-template">
    <li class="app-card">
      <div class="app-thumbnail-wrapper">
        <img class="app-thumbnail" alt="" />
        <div class="app-thumbnail-placeholder">
          <i data-lucide="package"></i>
        </div>
        <button class="btn-favorite" title="Toggle favorite">
          <i data-lucide="star" class="star-icon"></i>
        </button>
      </div>
      <div class="app-content">
        <h3 class="app-name"></h3>
        <a class="app-url" target="_blank" rel="noopener"></a>
      </div>
      <div class="app-actions">
        <button class="btn-primary open" title="Open in new tab">
          <i data-lucide="external-link"></i>
          <span>Open</span>
        </button>
        <button class="btn-ghost edit" title="Edit">
          <i data-lucide="pencil"></i>
        </button>
        <button class="btn-ghost btn-danger delete" title="Delete">
          <i data-lucide="trash-2"></i>
        </button>
      </div>
    </li>
  </template>

  <template id="app-list-item-template">
    <li class="app-list-item">
      <div class="list-item-thumbnail-wrapper">
        <img class="list-item-thumbnail" alt="" />
        <div class="list-item-thumbnail-placeholder">
          <i data-lucide="package"></i>
        </div>
      </div>
      <div class="list-item-content">
        <h3 class="list-item-name"></h3>
        <a class="list-item-url" target="_blank" rel="noopener"></a>
      </div>
      <div class="list-item-actions">
        <button class="btn-favorite" title="Toggle favorite">
          <i data-lucide="star" class="star-icon"></i>
        </button>
        <button class="btn-primary open" title="Open in new tab">
          <i data-lucide="external-link"></i>
          <span>Open</span>
        </button>
        <button class="btn-ghost edit" title="Edit">
          <i data-lucide="pencil"></i>
        </button>
        <button class="btn-ghost btn-danger delete" title="Delete">
          <i data-lucide="trash-2"></i>
        </button>
      </div>
    </li>
  </template>

  <script src="/app.js"></script>
  <script>
    lucide.createIcons();
  </script>
</body>

</html>